---	
title: Какое исключение бросать в swith, если подходящего case не нашлось?
tags: cleancode
published: false	
---	

## В чём проблема

```
enum SomeEnum
{
  One,
  Two
}

void someFunc()
{
  SomeEnum value = someOtherFunc();
  switch(value)
  {
     case One:
       //Обрабатываем
       ...
       break;
     case Two:
      //Обрабатываем
       ...
       break;
     default:
       throw new Exception();   
       //Какое исключение правильно бросать?
  }
}
```

Есть несколько вариантов типа выбрасываемого исключения, в этой заметке я хочу рассмотреть какое исключение, в какой ситуации, будет правильно использовать.

## А нужно ли вообще бросать исключение

Во-первых, я должен заметить, что могут быть ситуации, когда отсутствие подходящего case - это вообще не ошибка, так как ваш switch может изначально предусматривать только обработку ограниченного скопа значений.

Во-вторых, если то что подходящего case не нашлось - это предусмотренная вами ошибка, часть потока выполнения программы, часть её алгоритма работы, то best practice - это не использовать исключения для управления потоком выполнения программы (читайте [Are exceptions as control flow considered a serious antipattern? If so, Why?](https://softwareengineering.stackexchange.com/q/189222/236856)), перепишите метод так, чтобы возвращать ошибку как результат выполнения метода, например.

Здесь я рассматриваю вопрос, какое исключение нужно бросать, только в контексте ситуации, когда switch должен содержать обработку всего возможного диапазона значений, но по какой-то причине не содержит (добавили новое значение enum'а или добавили новый тип и т.п., а switch не изменили) - в большинстве случаев это будет исключительной ситуацией, в которой лучше всего как можно скорее упасть (почему лучше как можно скорее упасть читайте в статье [Fail Fast](https://www.martinfowler.com/ieeeSoftware/failFast.pdf)) и сообщить пользователю или вызывающему модулю о возникновении непредвиденной ошибки выбросив исключение.

## Имеет ли значение какое исключение бросать

В C# не принято бросать исключение базового типа Exception, Microsoft изначально создало большое количество типов исключений на все возможные случаи жизни и общепринятая практика выбирать исключение подходящее под ситуацию для которой оно было создано, но само по себе бросание исключения абстрактного "правильного типа" несёт в себе только семантическую чистоту и согласованность кода, когда программные конструкции используются по назначению, для которого были созданы.

С практической же точки зрения использование конкретного типа исключения может обоснываться двумя причинами:

1. В программе существуют специальные обработчики для этого типа исключения
2. Упрощение процесса поиска места возникновения и причины исключения, а также передача дополнительной информации о контексте возникновения исключения

Здесь я буду рассматривать вопрос "правильности" используемого типа, только с точки зррения семантической релевантности использования конкретного типа исключения, в конкретной ситуации.

## Какие исключения подходят для выбрасывания из switch

### InvalidOperationException


