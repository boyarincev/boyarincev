---
title: Про Entity Framework и DDD
tags: entityframework, DDD
---

Обычно так случалось, что если архитектура у нас по DDD, а проект более менее большой и серьёзный, то мы как правило разделяли доменную и дата модели на две отдельные, потому что Entity Framework в своих ранних версиях накладывал много ограничений и специфичных требований на модели, но в процессе взросления EF эти ограничения становились всё меньше и теперь уже Entity Framework Core позволяет в качестве и доменных и дата моделей использовать одну и ту же модель не идя на компромиссы. А как это делать можно прочитать в статьях Джули Лерман:

1. [DDD-Friendlier EF Core 2.0](https://msdn.microsoft.com/en-us/magazine/mt842503)
2. [DDD-Friendlier EF Core 2.0, Part 2](https://msdn.microsoft.com/magazine/mt826347)

Или посмотреть в её выступлении на NDC Conference: [Mapping DDD Domain Models with EF Core 2.1](https://youtu.be/Z62cbp61Bb8)

И ещё есть хорошая статья на хабре: [Сущности в DDD-стиле с Entity Framework Core](https://habr.com/ru/post/432410/)

Подход с объединением моделей проще, потому что при использовании отдельных моделей для домена и дата слоя необходимо решить проблему отслеживания изменений в доменных сущностях и правильного переноса этих изменений в дата модели, так чтобы Entity Framework смог сохранить всё корректно. Готовой статьи на эту тему дать не смогу, но, в принципе, эта проблема релевантна проблеме под названием "Работа с отсоединёнными сущностями" - в случае, когда доменные и дата модели разделены, доменные модели это по сути и есть отсоединённые сущности, так что идеи как решить проблему синхронизации доменных и дата моделей можно почерпнуть, изучая как решают проблему работы с отсоединёнными сущностями. А статья на эту тему, например, вот: [Доступ к данным - Обработка состояния отсоединенных сущностей в EF](https://msdn.microsoft.com/magazine/mt694083) всё той же Джули Лерман.

Ну и если говорить о DDD, то ещё можно затронуть тему Спецификаций и в статье ниже отличный пример того, как можно реализовать спецификации для использования в EF: [EntityFramework: (анти)паттерн Repository](https://habr.com/ru/post/335856/)
